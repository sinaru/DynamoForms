!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("dynamo-forms",[],r):"object"==typeof exports?exports["dynamo-forms"]=r():e["dynamo-forms"]=r()}("undefined"!=typeof self?self:this,function(){return function(e){var r={};function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(r){return e[r]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";t.r(r);class o{constructor(e){this._errors=[],this.validations=e}validate(){return this.validations.forEach(e=>{this[e[0]](e[1])}),0===this._errors.length}errors(){return this._errors}anyPresent(e){const r=e.defaultValues||[],t=(e.errorMsg,e.elements);Array.from(t).some(e=>""!==e.value&&!r.includes(e.value))||this._errors.push(e.errorMsg)}}o.Validators={ANY_PRESET:"anyPresent"};class n{constructor(e){this._form=e,this._reload(),this._handleFieldBehaviors(),this._handleFormSubmit()}validate(){return this._reload(),this._validators.every(e=>e.validate())}errors(){return this._validators.flatMap(e=>e.errors())}_handleFormSubmit(){this._form.addEventListener("submit",e=>{this.validate()||(this._renderErrors(this._form.querySelector(".errors")),e.preventDefault())})}_handleFieldBehaviors(){const e=this._form.querySelectorAll("*[data-dyn-behaviors]");Array.from(e).forEach(e=>this._handleFieldBehaviorForNode(e))}_handleFieldBehaviorForNode(e){e.getAttribute("data-dyn-behaviors").split("|").includes("enableOnValid")&&(e.disabled=!0,Array.from(this._nodes).forEach(r=>{r.addEventListener("input",()=>{this._enableOnValid(e)})}))}_enableOnValid(e){e.disabled=!this.validate()}_reload(){this._validators=[],this._nodes=this._form.querySelectorAll("*[data-dyn-field]"),this._generateValidationRules()}_renderErrors(e){e.innerHTML="",this.errors().forEach(r=>{e.insertAdjacentHTML("beforeend",`<div class='form-error'>${r}</div>`)})}_generateValidationRules(){this._nodes.forEach(e=>this._generateValidationRulesForNode(e))}_generateValidationRulesForNode(e){if(!e.hasAttribute("data-dyn-validators"))return;e.getAttribute("data-dyn-validators").split("|").forEach(r=>this._validateRuleForNode(e,r))}_validateRuleForNode(e,r){let t={};if(o.Validators.ANY_PRESET===r){t.validator=o.Validators.ANY_PRESET;const n=e.getAttribute("data-dyn-group");t.elements=Array.from(this._nodes).filter(e=>e.getAttribute("data-dyn-group")===n),t.errorMsg="At least one field is required";const a=new o([[r,t]]);this._validators.push(a)}}}window.onload=function(){document.querySelectorAll(".dynamo-forms").forEach(e=>new n(e))},t.d(r,"HtmlFormValidator",function(){return n})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9keW5hbW8tZm9ybXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2R5bmFtby1mb3Jtcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9keW5hbW8tZm9ybXMvLi9zcmMvZm9ybS12YWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vZHluYW1vLWZvcm1zLy4vc3JjL2h0bWwtZm9ybS12YWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vZHluYW1vLWZvcm1zLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkZvcm1WYWxpZGF0b3IiLCJbb2JqZWN0IE9iamVjdF0iLCJ2YWxpZGF0aW9ucyIsIl9lcnJvcnMiLCJmb3JFYWNoIiwidmFsaWRhdGlvbiIsImxlbmd0aCIsImRhdGEiLCJkZWZhdWx0VmFsdWVzIiwiZWxlbWVudHMiLCJlcnJvck1zZyIsIkFycmF5IiwiZnJvbSIsInNvbWUiLCJlbGVtZW50IiwiaW5jbHVkZXMiLCJwdXNoIiwiVmFsaWRhdG9ycyIsIkFOWV9QUkVTRVQiLCJodG1sX2Zvcm1fdmFsaWRhdG9yX0h0bWxGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJfZm9ybSIsIl9yZWxvYWQiLCJfaGFuZGxlRmllbGRCZWhhdmlvcnMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl92YWxpZGF0b3JzIiwiZXZlcnkiLCJ2YWxpZGF0b3IiLCJ2YWxpZGF0ZSIsImZsYXRNYXAiLCJlcnJvcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJfcmVuZGVyRXJyb3JzIiwicXVlcnlTZWxlY3RvciIsInByZXZlbnREZWZhdWx0Iiwibm9kZXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibm9kZSIsIl9oYW5kbGVGaWVsZEJlaGF2aW9yRm9yTm9kZSIsImdldEF0dHJpYnV0ZSIsInNwbGl0IiwiZGlzYWJsZWQiLCJfbm9kZXMiLCJpbnB1dE5vZGUiLCJfZW5hYmxlT25WYWxpZCIsIl9nZW5lcmF0ZVZhbGlkYXRpb25SdWxlcyIsInBhcmVudEVsZW1lbnQiLCJpbm5lckhUTUwiLCJlcnJvciIsImluc2VydEFkamFjZW50SFRNTCIsIl9nZW5lcmF0ZVZhbGlkYXRpb25SdWxlc0Zvck5vZGUiLCJoYXNBdHRyaWJ1dGUiLCJydWxlIiwiX3ZhbGlkYXRlUnVsZUZvck5vZGUiLCJzZWxlY3Rvckdyb3VwIiwiZmlsdGVyIiwiZWwiLCJ3aW5kb3ciLCJvbmxvYWQiLCJkb2N1bWVudCIsImZvcm0iLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLGlCQUFBQyxTQUFBLGlCQUFBQyxPQUNBQSxPQUFBRCxRQUFBRCxJQUNBLG1CQUFBRyxlQUFBQyxJQUNBRCxPQUFBLGtCQUFBSCxHQUNBLGlCQUFBQyxRQUNBQSxRQUFBLGdCQUFBRCxJQUVBRCxFQUFBLGdCQUFBQyxJQVJBLENBU0Msb0JBQUFLLFVBQUFDLEtBQUEsV0FDRCxtQkNUQSxJQUFBQyxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFSLFFBR0EsSUFBQUMsRUFBQUssRUFBQUUsR0FBQSxDQUNBQyxFQUFB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LEVBQUF3RixFQUFBLHNDQUFBM0MiLCJmaWxlIjoiZHluYW1vLWZvcm1zLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZHluYW1vLWZvcm1zXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImR5bmFtby1mb3Jtc1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJkeW5hbW8tZm9ybXNcIl0gPSBmYWN0b3J5KCk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuXG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRpb25zKSB7XG4gICAgdGhpcy5fZXJyb3JzID0gW107XG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IHZhbGlkYXRpb25zO1xuICB9XG5cbiAgdmFsaWRhdGUoKSB7XG4gICAgdGhpcy52YWxpZGF0aW9ucy5mb3JFYWNoKCh2YWxpZGF0aW9uKSA9PiB7XG4gICAgICB0aGlzW3ZhbGlkYXRpb25bMF1dKHZhbGlkYXRpb25bMV0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuX2Vycm9ycy5sZW5ndGggPT09IDA7XG4gIH1cblxuICBlcnJvcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Vycm9ycztcbiAgfVxuXG4gIGFueVByZXNlbnQoZGF0YSkge1xuICAgIC8vIGNvbnN0IHsgZGVmYXVsdFZhbHVlcywgc2VsZWN0b3JzLCBlcnJvck1zZyB9ID0ge1xuICAgIC8vICAgZGVmYXVsdFZhbHVlczogW10sXG4gICAgLy8gICAuLi5kYXRhLFxuICAgIC8vIH07XG5cbiAgICBjb25zdCBkZWZhdWx0VmFsdWVzID0gZGF0YS5kZWZhdWx0VmFsdWVzIHx8IFtdO1xuICAgIGNvbnN0IGVycm9yTXNnID0gZGF0YS5lcnJvck1zZztcbiAgICBjb25zdCBlbGVtZW50cyA9IGRhdGEuZWxlbWVudHM7XG4gICAgY29uc3Qgb25lSXNQcmVzZW50ID0gQXJyYXkuZnJvbShlbGVtZW50cykuc29tZSggKGVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiBlbGVtZW50LnZhbHVlICE9PSAnJyAmJiAhZGVmYXVsdFZhbHVlcy5pbmNsdWRlcyhlbGVtZW50LnZhbHVlKTtcbiAgICB9KTtcblxuICAgIGlmKCFvbmVJc1ByZXNlbnQpIHtcbiAgICAgIHRoaXMuX2Vycm9ycy5wdXNoKGRhdGEuZXJyb3JNc2cpXG4gICAgfVxuICB9XG59XG5cbkZvcm1WYWxpZGF0b3IuVmFsaWRhdG9ycz17XG4gIEFOWV9QUkVTRVQ6ICdhbnlQcmVzZW50J1xufTtcbiIsImltcG9ydCB7Rm9ybVZhbGlkYXRvcn0gZnJvbSAnLi9mb3JtLXZhbGlkYXRvcidcblxuXG5leHBvcnQgY2xhc3MgSHRtbEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihmb3JtRWxlbWVudCkge1xuICAgIHRoaXMuX2Zvcm0gPSBmb3JtRWxlbWVudDtcblxuICAgIHRoaXMuX3JlbG9hZCgpO1xuICAgIHRoaXMuX2hhbmRsZUZpZWxkQmVoYXZpb3JzKCk7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCgpO1xuICB9XG5cbiAgdmFsaWRhdGUoKSB7XG4gICAgdGhpcy5fcmVsb2FkKCk7XG4gICAgcmV0dXJuICB0aGlzLl92YWxpZGF0b3JzLmV2ZXJ5KHZhbGlkYXRvciA9PiB2YWxpZGF0b3IudmFsaWRhdGUoKSk7XG4gIH1cblxuICBlcnJvcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbGlkYXRvcnMuZmxhdE1hcCh2YWxpZGF0b3IgPT4gdmFsaWRhdG9yLmVycm9ycygpKVxuICB9XG4gIF9oYW5kbGVGb3JtU3VibWl0KCkge1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB2YWxpZEZvcm0gPSB0aGlzLnZhbGlkYXRlKCk7XG4gICAgICBpZighdmFsaWRGb3JtKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlckVycm9ycyh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoJy5lcnJvcnMnKSk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBfaGFuZGxlRmllbGRCZWhhdmlvcnMoKSB7XG4gICAgY29uc3Qgbm9kZXMgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJypbZGF0YS1keW4tYmVoYXZpb3JzXScpO1xuICAgIEFycmF5LmZyb20obm9kZXMpLmZvckVhY2gobm9kZSA9PiB0aGlzLl9oYW5kbGVGaWVsZEJlaGF2aW9yRm9yTm9kZShub2RlKSk7XG4gIH1cblxuICBfaGFuZGxlRmllbGRCZWhhdmlvckZvck5vZGUobm9kZSkge1xuICAgIGNvbnN0IGJlaGF2aW9ycyA9IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWR5bi1iZWhhdmlvcnMnKS5zcGxpdCgnfCcpO1xuXG4gICAgaWYoYmVoYXZpb3JzLmluY2x1ZGVzKCdlbmFibGVPblZhbGlkJykpIHtcbiAgICAgIG5vZGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgQXJyYXkuZnJvbSh0aGlzLl9ub2RlcykuZm9yRWFjaCgoaW5wdXROb2RlKSA9PiB7XG4gICAgICAgIGlucHV0Tm9kZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICB0aGlzLl9lbmFibGVPblZhbGlkKG5vZGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgX2VuYWJsZU9uVmFsaWQobm9kZSkge1xuICAgIG5vZGUuZGlzYWJsZWQgPSAhdGhpcy52YWxpZGF0ZSgpO1xuICB9XG5cbiAgX3JlbG9hZCgpIHtcbiAgICB0aGlzLl92YWxpZGF0b3JzID0gW107XG4gICAgdGhpcy5fbm9kZXMgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJypbZGF0YS1keW4tZmllbGRdJyk7XG4gICAgdGhpcy5fZ2VuZXJhdGVWYWxpZGF0aW9uUnVsZXMoKTtcbiAgfVxuXG4gIF9yZW5kZXJFcnJvcnMocGFyZW50RWxlbWVudCkge1xuICAgIHBhcmVudEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG4gICAgdGhpcy5lcnJvcnMoKS5mb3JFYWNoKGVycm9yID0+IHtcbiAgICAgIHBhcmVudEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgPGRpdiBjbGFzcz0nZm9ybS1lcnJvcic+JHtlcnJvcn08L2Rpdj5gKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9nZW5lcmF0ZVZhbGlkYXRpb25SdWxlcygpIHtcbiAgICB0aGlzLl9ub2Rlcy5mb3JFYWNoKG5vZGUgPT4gdGhpcy5fZ2VuZXJhdGVWYWxpZGF0aW9uUnVsZXNGb3JOb2RlKG5vZGUpKTtcbiAgfVxuXG4gIF9nZW5lcmF0ZVZhbGlkYXRpb25SdWxlc0Zvck5vZGUobm9kZSkge1xuICAgIGlmKCFub2RlLmhhc0F0dHJpYnV0ZSgnZGF0YS1keW4tdmFsaWRhdG9ycycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHZhbGlkYXRpb25SdWxlcyA9IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWR5bi12YWxpZGF0b3JzJykuc3BsaXQoJ3wnKTtcbiAgICB2YWxpZGF0aW9uUnVsZXMuZm9yRWFjaChydWxlID0+IHRoaXMuX3ZhbGlkYXRlUnVsZUZvck5vZGUobm9kZSwgcnVsZSkpO1xuICB9XG5cbiAgX3ZhbGlkYXRlUnVsZUZvck5vZGUobm9kZSwgcnVsZSkge1xuICAgIGxldCBkYXRhID0ge307XG4gICAgaWYoRm9ybVZhbGlkYXRvci5WYWxpZGF0b3JzLkFOWV9QUkVTRVQgID09PSBydWxlKSB7XG4gICAgICBkYXRhLnZhbGlkYXRvciA9IEZvcm1WYWxpZGF0b3IuVmFsaWRhdG9ycy5BTllfUFJFU0VUO1xuXG4gICAgICBjb25zdCBzZWxlY3Rvckdyb3VwID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZHluLWdyb3VwJyk7XG4gICAgICBkYXRhLmVsZW1lbnRzID0gQXJyYXkuZnJvbSh0aGlzLl9ub2RlcykuZmlsdGVyKGVsID0+IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1keW4tZ3JvdXAnKSA9PT0gc2VsZWN0b3JHcm91cCk7XG4gICAgICBkYXRhLmVycm9yTXNnID0gJ0F0IGxlYXN0IG9uZSBmaWVsZCBpcyByZXF1aXJlZCc7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFtbcnVsZSwgZGF0YV1dKTtcbiAgICAgIHRoaXMuX3ZhbGlkYXRvcnMucHVzaCh2YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxufVxuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmR5bmFtby1mb3JtcycpO1xuICBmb3Jtcy5mb3JFYWNoKChmb3JtKSA9PiBuZXcgSHRtbEZvcm1WYWxpZGF0b3IoZm9ybSkpO1xufTtcbiIsImltcG9ydCB7IEh0bWxGb3JtVmFsaWRhdG9yIH0gZnJvbSAnLi9odG1sLWZvcm0tdmFsaWRhdG9yJ1xuXG5leHBvcnQgeyBIdG1sRm9ybVZhbGlkYXRvciB9Il0sInNvdXJjZVJvb3QiOiIifQ==